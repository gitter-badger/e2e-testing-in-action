<!doctype html>

<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="main.css">
    <link href='https://fonts.googleapis.com/css?family=Antic' rel='stylesheet' type='text/css'>
</head>

<body>
<main>
    <header>
        <div class="wrapper">
            <img src="images/protractor-selenium.png">

            <h1>Selenium/Protractor in action</h1>

            <img src="images/icon-browserstack.png">
            <img src="images/mocha-icon.svg">
        </div>
    </header>

    <article>
        <div class="content-container">
            <div class="content">
                If you kick off some tests in selenium or protractor chances are that they run smoothly in one browser
                but not even start in the other.
                The reason for that can be anything and more often than not, hard to solve. That is why I started
                <a href="https://github.com/scaljeri/selenium-protractor-browserstack">this</a> project on GitHub to
                demonstrate how you can use selenium
                or protractor with different browser and run test locally, remote or in parallel .

                Before you begin follows the steps describe in the project's <a
                    href="https://github.com/scaljeri/selenium-protractor-browserstack">README</a>
                to install all required libraries.
            </div>


            <h2>Basic Authentication</h2>
            <div class="content first-dark-red">
                As you might already know selenium cannot control the native popup you get using basic authentication. In my
                search to solve this I found two solution which overcome these shortcomings. <br><br>

                The most easiest solution is to add the username and password to the url

                <pre style='color:#000020;background:#f6f8ff;'>http://foo:bar@localhost</pre>
                <br>

                Thats it, BUT not for Firefox, they have an addition popup

                <img src="images/extra-popup.png">
                <br>

                Fortunately this popup can be disabled with the config property <strong>network.http.phishy-userpass-length</strong>.
                It can be implemented using <a href="https://github.com/SeleniumHQ/selenium/wiki/FirefoxDriver">Firefox profiles</a>, which
                I have implemented <a href="https://github.com/scaljeri/selenium-protractor-browserstack/blob/master/src/utils/driver.js#L116">here</a>.
                <br><br>

                But there is an other way to solve this, but it requires a different setup. The site itself should be public and the
                authentication part protected. From there you will be redirect to your public site with some kind of authentication token
                in the url. In such case you can do the authentication with nodeJs only. You can see it in action
                <a href="https://github.com/scaljeri/selenium-protractor-browserstack/blob/master/src/index.js#L40">here</a>.
            </div>

            <h2>Local testing</h2>
            <div class="content first-dark-blue">
                There is only one test, which is

                <pre style='color:#000020;background:#f6f8ff;'>expect<span style='color:#308080; '>(</span>HomePo<span style='color:#308080; '>.</span>title<span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>toEqual<span style='color:#308080; '>(</span><span style='color:#800000; '>'</span><span style='color:#1060b6; '>Hello world!</span><span style='color:#800000; '>'</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span></pre>
                <br>

                Not very spectacular, but it serves its purpose very well :) This test can be performed using nodeJs only

                <pre style='color:#000020;background:#f6f8ff;'>$<span style='color:#308080; '>></span> .<span style='color:#308080; '>/</span>node_modules<span style='color:#308080; '>/</span>.bin<span style='color:#308080; '>/</span>babel<span style='color:#308080; '>-</span>node .<span style='color:#308080; '>/</span>src<span style='color:#308080; '>/</span>index<span style='color:#008c00; '>.</span>js</pre>

                To simplify things a bit most commands are added to <a href="https://github.com/scaljeri/selenium-protractor-browserstack/blob/master/package.json#L21">package.js</a>.
                The above command can also be executed as

                <pre style='color:#000020;background:#f6f8ff;'>$<span style='color:#308080; '>></span> npm start</pre>

                <a href="https://github.com/scaljeri/selenium-protractor-browserstack/blob/master/src/index.js#L26">code</a>
                <br>

                A couple of command line arguments can be added, like <strong>--browser</strong>

                <pre style='color:#000020;background:#f6f8ff;'>$<span style='color:#308080; '>></span> npm start <span style='color:#308080; '>-</span><span style='color:#308080; '>-</span> <span style='color:#308080; '>-</span><span style='color:#308080; '>-</span>browser firefox</pre>

                This time selenium kicks in and uses firefox (<a href="https://github.com/scaljeri/selenium-protractor-browserstack/blob/master/src/index.js#L20">code</a>). Currently you can only use Firefox version 47.
                <br>

                For protractor and Mocha its basically the same

                <pre style='color:#000020;background:#f6f8ff;'>$<span style='color:#308080; '>></span> npm run test:mocha <span style='color:#308080; '>-</span><span style='color:#308080; '>-</span> <span style='color:#308080; '>-</span><span style='color:#308080; '>-</span>browser chrome
$<span style='color:#308080; '>></span> npm run test:protractor <span style='color:#308080; '>-</span><span style='color:#308080; '>-</span> <span style='color:#308080; '>-</span><span style='color:#308080; '>-</span>browser safari</pre>

                <a href="https://github.com/scaljeri/selenium-protractor-browserstack/blob/master/src/mocha.js">Mocha code</a>, <a href="https://github.com/scaljeri/selenium-protractor-browserstack/blob/master/tests/protractor.conf.js">Protractor config</a>
                <br>

                With the current version of Protractor you don't need to use firefox profiles, its all taken care of now!
            </div>

            <h2>Local testing with selenium standalone</h2>
            <div class="content">
                First start the selenium hub

                <pre style='color:#000020;background:#f6f8ff;'>$<span style='color:#308080; '>></span> java <span style='color:#308080; '>-</span>jar selenium<span style='color:#308080; '>-</span>server<span style='color:#308080; '>-</span>standalone<span style='color:#308080; '>-</span><span style='color:#008c00; '>3.0.1.</span>jar</pre>

                Now you can run the same commands as described above with addition of one parameter<strong>--selenium-standalone</strong>
                <br>
                Unfortunately, it is not possible to use Firefox and Safari, they produce errors which I haven't solved yet. Feel free to
                help and send me a <a href="https://help.github.com/articles/about-pull-requests/">PR</a> :)

            </div>

            <h2>Remote testing with Browserstack</h2>
            <p class="first-dark-red">
                In order to use browserstack you need a username and a key. If you don't have an account you can sign-up for a free one, which
                gives you access to a lot of time to test remotely. To enable remote testing you can add the <strong>--browserstack-user</strong> <strong>username</strong>
                and <strong>--browserstack-key</strong> <strong>key</strong> argument to the above commands and the the tests will auto-magically run on browserstack :)

            <pre style='color:#000020;background:#f6f8ff;'>$<span style='color:#308080; '>></span> npm start <span style='color:#308080; '>-</span><span style='color:#308080; '>-</span> <span style='color:#308080; '>-</span><span style='color:#308080; '>-</span>browser ie <span style='color:#308080; '>-</span><span style='color:#308080; '>-</span>browser<span style='color:#308080; '>-</span>version<span style='color:#308080; '>=</span><span style='color:#008c00; '>9</span>
                <span style='color:#308080; '>-</span><span style='color:#308080; '>-</span>os<span style='color:#308080; '>=</span>windows <span style='color:#308080; '>-</span><span style='color:#308080; '>-</span>os<span style='color:#308080; '>-</span>version<span style='color:#308080; '>=</span><span style='color:#008c00; '>7</span>
                <span style='color:#308080; '>-</span><span style='color:#308080; '>-</span>browserstack<span style='color:#308080; '>-</span>user barfoo <span style='color:#308080; '>-</span><span style='color:#308080; '>-</span>browserstack<span style='color:#308080; '>-</span>key liufo7ag4</pre>

            This time you can run the test against any OS or browser(version), tablet or android device. Note that you can use other versions of firefox too! But
            there is more, with Basic Authentication you don't need to use firefox profiles, the url with credentiakls is enough, they fixed that too, it's true.

            <h2>Conclusion</h2>
            <p class="first-dark-blue">
                Considering all the work you have to do to get testing on your local machine up and running, I advice to use Browserstack. They have
                and will solve all the issue that can possibly happen. Like they did with Basic authentication. Local testing is of course faster, and is
                probably the only reason why you want to do it.
            </p>
        </div>
    </article>
</main>
<script>
    var header = document.querySelector('header'), isMinified = false;

    window.onscroll = function (event) {
        if (window.pageYOffset > 100) {
            if (!isMinified) {
                header.classList.add('minified');
                isMinified = true;
            }
        } else if (isMinified) {
            header.classList.remove('minified');
            isMinified = false;
        }
    }
</script>
</body>
</html>
